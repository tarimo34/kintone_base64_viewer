# kintone_base64_viewer リポジトリ調査結果

## 概要
このリポジトリは **kintone_base64_viewer** というプロジェクトで、サイボウズのkintoneアプリケーション向けのJavaScriptカスタマイズツールです。

## 主な機能
Base64形式でエンコードされた画像データの文字列を実際の画像として表示するkintoneカスタマイズです。

### 具体的な機能:
- 指定したフィールドからBase64エンコードされた画像データ（文字列）を取得
- 画像データの有効性を検証
- 有効な画像データの場合、指定されたスペースフィールドに表示
- 画像をクリックすると拡大表示するモーダルウィンドウ機能

## 技術仕様

### 対象環境
- **プラットフォーム**: サイボウズ kintone
- **言語**: JavaScript
- **実装方式**: kintoneカスタマイズスクリプト

### 必要な設定
1. kintoneアプリに「Base64Viewer」という名前のフィールド（テキストエリアなど）を作成
2. レコード詳細画面に「SP_Viewer」という名前のスペースフィールドを配置
3. デフォルトのフィールドコードは `base64viewer`（変更可能）

### 動作フロー
1. レコード詳細画面の表示時に自動実行
2. 指定フィールドからBase64データを取得
3. データの存在確認とフォーマット検証
4. サイズ制限チェック（約350KB上限）
5. 画像データとしての有効性検証
6. 有効な場合は画像表示（最大幅300px）
7. クリックでモーダル拡大表示

## セキュリティ対策

### 実装されている対策
1. **XSS（クロスサイトスクリプティング）対策**
   - `innerHTML`使用を最小限に抑制
   - `textContent`と`createElement`+`appendChild`を使用

2. **Base64データの妥当性チェック**
   - 正規表現による文字レベル検証
   - Base64文字のみ許可（A-Z, a-z, 0-9, +, /, =）

3. **DoS（Denial-of-Service）対策**
   - データサイズ上限設定（500,000文字、約350KB）
   - 大容量データによるブラウザ負荷防止

4. **MIMEタイプの柔軟性**
   - `data:`プレフィックスの自動判定・追加
   - 多様な画像形式への対応

5. **DOM要素の名前空間管理**
   - 専用クラス名による競合回避

## プロジェクト情報

### ライセンス
- **MIT License**
- 著作権者: Satoshi Morita (2025)

### バージョン履歴
- **Version 1.0**: 基本機能実装（画像表示、モーダル、簡易検証）
- **Version 2.0**: セキュリティ強化版（XSS対策、DoS対策、厳格な検証）

### リポジトリ構成
```
.
├── .git/          # Gitバージョン管理
├── LICENSE        # MITライセンス
└── README.md      # プロジェクト詳細ドキュメント
```

## 開発履歴
- 初期コミット: `f0adcb7 Initial commit`
- README更新: `27be205 Update README.md`

## 用途・適用場面
- kintoneアプリでBase64エンコードされた画像データを扱う場合
- データベースにバイナリデータを文字列として保存している画像の表示
- セキュアな画像表示機能が必要なビジネスアプリケーション
- 画像データの検証・表示機能を安全に実装したい場合

このツールは、kintoneの標準機能では対応しきれないBase64画像データの安全な表示を実現する専用カスタマイズです。